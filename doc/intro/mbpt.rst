iDEA MBPT (Many Body Perturbation Theory)
========================================

The purpose of the Many-Body Perturbation theory (MBPT) code is to produce the charge density of a ground-state system using the GW approximation (plus our novel vertex corrections) using
various starting orbitals and varying levels of self consistency.

The first step in this implementation is to construct the non interacting Green's function, it is constructed in the imaginary time domain from a set of orbitals and energies
generated by diagonalising a Kohn-Sham Hamiltonian. This Hamiltonian contains a Kohn-Sham potential imported into the code either from the non-interacting, exact many-body
or LDA codes. These orbitals and energies are subbed directly into the equation for the non-interacting Green's function in imaginary time.

    .. math ::

        G_0\left(x_1,x_2,i\tau\right)=\Bigg\{
        \begin{matrix}
        i\sum_{i}^{occ}\phi_n\left(x_1\right)\phi^{*}_{n}\left(x_2\right)e^{-E_{n}\tau} \quad \tau\le 0  \\
        -i\sum_{i}^{unocc}\phi_n\left(x_1\right)\phi^{*}_{n}\left(x_2\right)e^{-E_{n}\tau} \quad \tau>0
        \end{matrix}

where the number of occupied orbitals is defined by the number of electrons in the system. Also, the alternative Green's Function is constructed using the alternate definition at :math:`\tau=0` using
the other side of the discontinuity, so the definition becomes

    .. math ::

        G_{0}^{ALT}\left(x_1,x_2,i\tau\right)=\Bigg\{
        \begin{matrix}
        i\sum_{i}^{occ}\phi_n\left(x_1\right)\phi^{*}_{n}\left(x_2\right)e^{-E_{n}\tau} \quad \tau< 0  \\
        -i\sum_{i}^{unocc}\phi_n\left(x_1\right)\phi^{*}_{n}\left(x_2\right)e^{-E_{n}\tau} \quad \tau\ge 0
        \end{matrix}

The initial guess for the interacting green's function :math:`G` is taken to be the non-interacting green's function :math:`G_0`. The next stage was to construct the polarisation propagator :math:`P`
in the imaginary time domain. This is simple to construct from the GW equations, the only complexity was recognising that at :math:`\tau=0` both the standard and alternative greens functions
must be used to construct :math:`P` due to their different definitions at :math:`\tau=0`.

.. math:: P\left(x_1,x_2,i\tau\right) = -iG\left(x_1,x_2,i\tau\right)G\left(x_2,x_1,-i\tau\right)
.. math:: P\left(x_1,x_2,0\right) = -iG\left(x_1,x_2,0\right)G^{ALT}\left(x_2,x_1,0\right)

The next stage was to construct the screened coulomb interaction. From the GW equations we can see that W is written as a convolution in the imaginary time domain, if we appropriately
transform the quantities into the imaginary frequency domain we can write out the Dyson equation corresponding to :math:`W` as a matrix equation.

.. math:: \bf{W}\left(\omega\right)=\bf{v}+\bf{v}\bf{P}\left(\omega\right)\bf{W}\left(\omega\right)

Which can be rearranged for the screened coulomb interaction:

.. math:: \bf{W}\left(\omega\right)=\left(\bf{I}-\bf{v}\bf{P}\left(\omega\right)\right)^{-1}\bf{v}

The screened coulomb interaction is calculated using this definition over the imaginary frequency domain and then Fourier transformed back into the imaginary time domain.

The next stage was to construct the self energy :math:`\Sigma` in the imaginary time domain, the exchange correlation term is simple to construct from the GW equations:

.. math:: \Sigma_{xc}\left(x_1,x_2,i\tau\right) = iG\left(x_1,x_2,i\tau\right)W\left(x_1,x_2,i\tau\right)

The Hartree term is then added by adding the Hartree potential along the diagonal of :math:`\Sigma` at :math:`\tau=0`:

.. math:: \Sigma\left(x,x,0\right) = \Sigma_{xc}\left(x,x,0\right) + V_{H}\left(x\right)

The final stage of the GW method is to update :math:`G` using the new value of :math:`\Sigma` using the Dyson equation for the Green's function in the imaginary frequency domain:

.. math:: \bf{G}\left(\omega\right)=\bf{G_0}\left(\omega\right)+\bf{G_0}\left(\omega\right)\bf{\Sigma}\left(\omega\right)\bf{G}\left(\omega\right)

Which can be rearranged for the Green's function:

.. math:: \bf{G}\left(\omega\right)=\left(\bf{I}-\bf{G_0}\left(\omega\right)\bf{\Sigma}\left(\omega\right)\right)^{-1}\bf{G_0}\left(\omega\right)

Another complexity arises when updating the Green's function using the Dyson equation, the fermi energy of the Green's function becomes changed after an iteration of the
Dyson equation, this would cause the density given by the updated Green's function to contain unoccupied as well as occupied states. To fix this the self energy must be
appropriately shifted in the frequency domain, called the 'Hedin Shift' This is implemented by adding the expectation value of :math:`\Sigma` at the fermi energy to
:math:`\Sigma` in the imaginary frequency domain.

.. math:: \mathbf{\Sigma}\left(i\omega\right) \rightarrow \mathbf{\Sigma}\left(i\omega\right) - \mathbf{I}\frac{\langle \phi_L | \mathbf{\Sigma}\left(0\right) | \phi_L \rangle + \langle \phi_H | \mathbf{\Sigma}\left(0\right) | \phi_H \rangle}{2}

Where :math:`\phi_H` and :math:`\phi_L` are the HOMO (highest occupied molecular orbital) and LUMO (lowest occupied molecular orbital) states respectively. Once :math:`G` is updated,
the cycle can begin again, and repeating until :math:`G` has reached self consistency\footnote{The self consistency is at the level of the density not of :math:`G` itself} or
until a desired number of iterations has been reached (one one in the case of one-shot calculations). Finally once the desired :math:`G` is reached the density can be
calculated using equation \ref{density}. Finally, this density is given to the reverse-engineering algorithm to produce a GW Kohn-Sham potential.


References
----------

.. [Rojas1995] Rojas HN, Godby RW, Needs RJ (1995) Space-Time Method for Ab Initio Calculations of Self-Energies and Dielectric Response Functions of Solids. Phys Rev Lett 74:1827–1830. doi: 10.1103/PhysRevLett.74.1827

.. [Rieger1999] Rieger MM, Steinbeck L, White ID, et al. (1999) The GW space-time method for the self-energy of large systems. Computer Physics Communications 117:211–228. doi: 10.1016/S0010-4655(98)00174-X

.. [Hedin1970] Hedin L, Lundqvist S (1970) Effects of Electron-Electron and Electron-Phonon Interactions on the One-Electron States of Solids. In: Frederick Seitz DT and HE (ed) Solid State Physics. Academic Press, pp 1–181
